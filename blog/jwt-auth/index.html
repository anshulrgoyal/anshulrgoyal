<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="alternate" type="application/rss+xml" href="/anshulrgoyal/blog/rss.xml" title="Anshul Goyal Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/anshulrgoyal/blog/atom.xml" title="Anshul Goyal Blog Atom Feed"><title data-react-helmet="true">A Practical Guide for JWT Authentication Using Node.js and Express | Anshul Goyal</title><meta data-react-helmet="true" property="og:title" content="A Practical Guide for JWT Authentication Using Node.js and Express | Anshul Goyal"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="description" content="Traditional authentication strategy makes use of sessions and cookies, but scaling these solutions is very difficult ‚Äî as some kind of state is maintained by the server. JWT, on the other hand, provides a stateless solution for authentication, and stateless applications are pretty easy to scale."><meta data-react-helmet="true" property="og:description" content="Traditional authentication strategy makes use of sessions and cookies, but scaling these solutions is very difficult ‚Äî as some kind of state is maintained by the server. JWT, on the other hand, provides a stateless solution for authentication, and stateless applications are pretty easy to scale."><meta data-react-helmet="true" property="og:url" content="https://anshulrgoyal.github.io/anshulrgoyal/blog/jwt-auth"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:image" content="https://cdn-images-1.medium.com/max/10836/1*WrDrIa0v80eL43PK-Wtu-w.jpeg"><meta data-react-helmet="true" name="twitter:image" content="https://cdn-images-1.medium.com/max/10836/1*WrDrIa0v80eL43PK-Wtu-w.jpeg"><link data-react-helmet="true" rel="shortcut icon" href="/anshulrgoyal/img/anshul.jpg"><link data-react-helmet="true" rel="canonical" href="https://anshulrgoyal.github.io/anshulrgoyal/blog/jwt-auth"><link data-react-helmet="true" rel="alternate" href="https://anshulrgoyal.github.io/anshulrgoyal/blog/jwt-auth" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://anshulrgoyal.github.io/anshulrgoyal/blog/jwt-auth" hreflang="x-default"><link rel="stylesheet" href="/anshulrgoyal/assets/css/styles.056d3a92.css">
<link rel="preload" href="/anshulrgoyal/assets/js/runtime~main.113fc30b.js" as="script">
<link rel="preload" href="/anshulrgoyal/assets/js/main.56fd1749.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?t("light"):t("dark")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" role="banner"><div class="announcementBarContent_3EUC announcementBarCloseable_3myR">I am looking for a JOB.</div><button type="button" class="announcementBarClose_38nx clean-btn" aria-label="Close"><span aria-hidden="true">√ó</span></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/anshulrgoyal/"><b class="navbar__title">Anshul Goyal</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/anshulrgoyal/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/anshulrgoyal/projects">Conributions</a><a href="https://github.com/anshulrgoyal" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--checked react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">üåû</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/anshulrgoyal/"><b class="navbar__title">Anshul Goyal</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/anshulrgoyal/projects">Conributions</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/anshulrgoyal/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/anshulrgoyal" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/anshulrgoyal/blog/deno-plugin">How to create a Deno plugin in Rust</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/anshulrgoyal/blog/macro-rust">An intro to macros in rust</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/anshulrgoyal/blog/mlh-fellowship">MLH Fellowship: A new way of learning</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/anshulrgoyal/blog/easy-documentation-docusaurus">Easy Documentation using Docusaurus</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/anshulrgoyal/blog/rust-auth-lib">The state of Rust: Authorization/authentication libraries</a></li></ul></nav></aside><main class="col col--7"><article><header><h1 class="blogPostTitle_GeHD">A Practical Guide for JWT Authentication Using Node.js and Express</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2019-01-14T00:00:00.000Z">January 14, 2019</time> ¬∑ 7 min read</div><div class="avatar margin-vert--md"><a href="https://github.com/anshulrgoyal" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="/img/anshul.jpg" alt="Anshul Goyal"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/anshulrgoyal" target="_blank" rel="noopener noreferrer">Anshul Goyal</a></div><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><p>Traditional authentication strategy makes use of sessions and cookies, but scaling these solutions is very difficult ‚Äî as some kind of state is maintained by the server. JWT, on the other hand, provides a stateless solution for authentication, and stateless applications are pretty easy to scale.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="advantages-of-jwt"></a>Advantages of JWT<a class="hash-link" href="#advantages-of-jwt" title="Direct link to heading">#</a></h4><ul><li><p>Provides a stateless authentication solution</p></li><li><p>Very popular and used by many OAuth service providers, like Google and Facebook</p></li><li><p>It‚Äôs very easy to verify a JWT token</p></li><li><p>More trustworthy than cookies and sessions</p></li><li><p>Authentication can be outsourced, or an authentication service can be used</p></li><li><p>Have many applications other than authentication ‚Äî for instance, it can be used for claims</p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="content"></a>Content<a class="hash-link" href="#content" title="Direct link to heading">#</a></h4><ul><li><p>JWT structure and overview</p></li><li><p>The JWT authentication mechanism</p></li><li><p>Using JWT authentication with Node.js</p></li></ul><hr><header><h1 class="h1Heading_27L5">What‚Äôs JWT?</h1></header><p>A JSON Web Token (JWT) is a <a href="http://www.w3schools.com/json/" target="_blank" rel="noopener noreferrer">JSON object</a> that‚Äôs defined in <a href="https://tools.ietf.org/html/rfc7519" target="_blank" rel="noopener noreferrer">RFC 7519</a> as a safe way to represent a set of information between two parties. The token is composed of a header, a payload, and a signature.</p><p>JWT is used for authentication, and they can also be used for sharing information. Most JWT are signed using a public key and a private key; therefore, it‚Äôs very difficult to tamper with these tokens. JWT has three parts: head, body and signature, each separated by <code>‚Äú.‚Äù</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="head"></a>Head<a class="hash-link" href="#head" title="Direct link to heading">#</a></h4><p>The head is a <code>base64Url</code><strong>-</strong>encoded, stringified JS object that contains information about the token. The head contains the type of token, the content type of the token, and an algorithm used to sign that token. The type is specified by the field type and the algorithm used to sign the token.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;alg&quot;: &quot;HS256&quot;,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;typ&quot;: &quot;JWT&quot;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The object is then converted to a string and encoded to <code>Base64Url</code>.</p><p>The following code shows how to change the encoding using the buffer module in Node.js.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Buffer.from(JSON.stringify({</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;alg&quot;: &quot;HS256&quot;,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;typ&quot;: &quot;JWT&quot;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">})).toString(&#x27;base64&#x27;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">.replace(/=/g, &quot;&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">.replace(/\+/g, &quot;-&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">.replace(/\//g, &quot;_&quot;);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Note: </strong><code>Base64</code> and <code>Base64URL</code> are the same; however, <code>+</code> is converted to <code>-</code>, and <code>/</code> is converted to <code>_</code> .</p><p>This is done to ensure there‚Äôs no collision between the query string and the token since <code>+</code> has a special meaning in the query string (the same goes for <code>/</code>).</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="body"></a>Body<a class="hash-link" href="#body" title="Direct link to heading">#</a></h4><p>The body is the as the head, but it contains the claim or data that‚Äôs transferred.</p><p>The body may contain special attributes like <code>iss</code> , <code>sub</code> , <code>aud</code>, <code>exp</code>, <code>iat</code>, <code>jti</code>, etc. These attributes have a standard implementation and are accepted by most OAuth services. Some interesting ones are <code>exp</code> and <code>iat</code>. <code>exp</code> specifies the time after which the token will become invalid, and <code>iat</code> specifies the time when the token was created.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;sub&quot;: &quot;90129920&quot;,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;uuid&quot;: &quot;sfgdsrfg434fdt535fg&quot;,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;iat&quot;: 1516239022,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;exp&quot;: 1545926973,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The time is used in seconds, following the 1 January 1970 format. The body is also converted to <code>Base64URL</code> using the same code as used in the head.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="signature"></a>Signature<a class="hash-link" href="#signature" title="Direct link to heading">#</a></h4><p>This is the most important part of the token because it‚Äôs used to verify if the token is valid and authentic. Let‚Äôs see how the signature is created.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">signature=sha256(base64URL(head)+&quot;.&quot;+base64URL(body))</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The token consists of the body and the head encrypted using any hashing algorithm ‚Äî for example, SHA-256.</p><p>The algorithm can be symmetrical or asymmetrical. It depends upon the needs of the application. The example below shows how we can create a signature for JWT.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">const crypto=require(&#x27;crypto&#x27;);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">const private_key=&quot;dfhghhghgdoghoghg&quot;;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">const sign = crypto.createHmac(&#x27;SHA256&#x27;, private_key)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">.update(head + &#x27;.&#x27; + body)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">.digest(&#x27;base64&#x27;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">.replace(/=/g, &quot;&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">.replace(/\+/g, &quot;-&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">.replace(/\//g, &quot;_&quot;)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>First, we create a stream from <code>crypto.createHmac</code>. We push the <code>base64url</code>-encoded head and body (separated by <code>‚Äú.‚Äù</code>) to the created stream. Then, we convert the buffer to the <code>base64</code>-encoded string and then to the <code>base64url</code>-encoded string.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="verification"></a>Verification<a class="hash-link" href="#verification" title="Direct link to heading">#</a></h4><p>When the server verifies the token, it creates the <code>hash</code> using the private key. If the <code>hash</code> matches the signature on the token, then the token is authentic.</p><p>If the token is tempered with, the <code>hash</code> of the token should change. But the hacker can‚Äôt create the new <code>hash</code> because the key is saved with the server. Therefore, the token is verified, and the client can also be verified using the data in the body.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">token=base64url(head)+&quot;.&quot;+baser64url(body)+&quot;.&quot;+signature</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><hr><header><h1 class="h1Heading_27L5">How Does Authentication With JWT Work?</h1></header><p>The token with <code>user_id</code> is given to the client, and the client sends the token back to the server every time the client makes an HTTP request to the server.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">body={</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> user_id:&quot;123nfdwf283&quot;,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The client must store the token in the browser. The token can be saved in local storage or session storage. Using local storage will keep the user signed in until the token expires, and session storage will keep the user logged in until the browser tab is closed. The token is sent to the server in the authorization header as <code>Bearer {token}</code>.</p><hr><header><h1 class="h1Heading_27L5">Using JWT With Node.js</h1></header><p>If you don&#x27;t want to write your own custom JWT solution, you can always use an npm module for it. We‚Äôd first install Express and the <a href="https://jwt.io/" target="_blank" rel="noopener noreferrer">JSON Web Tokens library</a>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">npm i express jsonwebtoken mongoose body-parser bcrypt</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The directory structure of the project:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   -app.js</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   -user.js</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   -key.js</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>key.js</code> contains the private key, but it‚Äôs not a good practice. You should always use an <code>.env</code> variable for such sensitive data.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">module.exports={tokenKey:&quot;djghhhhuuwiwuewieuwieuriwu&quot;}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The user schema consists of a presave hook. When we create a new user, the password is converted to <code>hash</code> and <code>salt</code> using bcryptjs. A static method is also added to the schema for comparing passwords using <code>hash</code> and<code>salt</code>.</p><p>Passwords are never saved in the database. The passwords are converted to a <code>hash</code> using any hashing algorithm, with the help of <code>salt</code>.</p><p><code>salt</code> acts as the private key for the creating the <code>hash</code>. When the user provides a password for login, the password and <code>salt</code> are used to create a <code>hash</code>. The created <code>hash</code> is then matched with the stored one. If both <code>hash</code>es match, then the password is matched.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">var mongoose = require(&#x27;mongoose&#x27;);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">var bcrypt = require(&#x27;bcryptjs&#x27;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">var userSchema = new mongoose.Schema({</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    first: String,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    email: {type:String,unique:true},</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    password: String,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    image:String</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">},{timestamps:true})</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">userSchema.pre(&#x27;save&#x27;, function (next) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    var user = this;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if (!user.isModified(&#x27;password&#x27;)) {return next()};</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    bcrypt.hash(user.password,10).then((hashedPassword) =&gt; {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        user.password = hashedPassword;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        next();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    })</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}, function (err) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    next(err)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">})</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">userSchema.methods.comparePassword=function(candidatePassword,next){    bcrypt.compare(candidatePassword,this.password,function(err,isMatch){</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if(err) return next(err);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        next(null,isMatch)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    })</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">module.exports = mongoose.model(&quot;user&quot;, userSchema);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Let‚Äôs create a simple Express server.</p><p>The route <code>/api/auth/signin</code> first matches the password and then issues a token to the user. The token is sent by the user to the server every time in the request header, and the token is parsed by the <code>app.use</code> middleware every time.</p><p>The middleware also adds user details to the req as <code>req.user</code> . The server listens on the port <code>3001</code> .We can also write a middleware for protecting routes.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">function proctectRoute(req,res,next){</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  // if user exists the token was sent with the request</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if(req.user){</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   //if user exists then go to next middleware</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     next();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// token was not sent with request send error to user</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  else{</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     res.status(500).json({error:&#x27;login is required&#x27;});</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We can use different options with the JSON Web Tokens library. We can set the expiration time, subject, time of issue, etc.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// we can change algorithm used</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">jwt.sign({ foo: &#x27;bar&#x27; }, cert,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{ algorithm:&#x27;RS256&#x27;},function(err,token) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    console.log(token);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">});</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// we can set expiration time using sync</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">const token =jwt.sign({data: &#x27;foobar&#x27;}, &#x27;secret&#x27;,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> { expiresIn: 60 * 60 });</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><hr><header><h1 class="h1Heading_27L5">Conclusion</h1></header><p>JSON Web Tokens are great for authentications and very easy to use. The tutorial shows us how we can use JWT for authentication using Node.js and Express.</p><p>JWT can also be used for different purposes, which includes any type of claim. The JWT used in the tutorial are signed using a symmetrical algorithm, but you can easily use asymmetrical algorithms also. In the asymmetrical algorithm, the private key is used to sign the token, and a public key is used for verifying the tokens.</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_3kfx"><div class="col"><b>Tags:</b><a class="margin-horiz--sm" href="/anshulrgoyal/blog/tags/jwt">jwt</a><a class="margin-horiz--sm" href="/anshulrgoyal/blog/tags/auth">auth</a><a class="margin-horiz--sm" href="/anshulrgoyal/blog/tags/nodejs">nodejs</a><a class="margin-horiz--sm" href="/anshulrgoyal/blog/tags/express">express</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/anshulrgoyal/blog/react-setup"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">¬´ Setting A React Project From Scratch Using Babel And Webpack</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">About</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/anshulrgoyal/projects">Contributions</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://dev.to/anshulgoyal15/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Dev.to<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://medium.com/@ar_goyal" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Medium<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/anshul-goyal-8aa479135/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/ar_goyal" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/anshulrgoyal/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/anshulrgoyal" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2021 Anshul Goyal. Built with Docusaurus.</div></div></div></footer></div>
<script src="/anshulrgoyal/assets/js/runtime~main.113fc30b.js"></script>
<script src="/anshulrgoyal/assets/js/main.56fd1749.js"></script>
</body>
</html>